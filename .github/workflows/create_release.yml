name: Create Release Branch
on:
  workflow_dispatch:
    inputs:
      version:
          type: choice
          description: Sematic version type of new version
          options:
          - patch
          - minor
          - major
jobs:
  release:
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v3
    - name: Git configuration
      run: |
        git config --global user.email "you@example.com"
        git config --global user.name "Your Name"
    - name: Upgrade version
      run: |
        echo "yarn --no-git-tag-version version --${{ github.event.inputs.release-type }}"
        yarn --no-git-tag-version version --${{ github.event.inputs.release-type }}
        echo "NEW_VERSION=$(npm pkg get version | tr -d '"')" >> $GITHUB_ENV
    - name: Create release branch
      run: |
        git checkout -b release/v${{ env.NEW_VERSION }}
        git status
        git commit -m "Upgrade version to $env.NEW_VERSION"
        git push origin
        gh pr create -B release/v${{ env.NEW_VERSION }} -H main --title 'Upgrade version to ${{ env.NEW_VERSION }}' --body 'Upgrade version to ${{ env.NEW_VERSION }}'
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
